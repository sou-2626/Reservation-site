<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>予約一覧</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #eee; }
    .back { margin-top: 20px; }
    button.delete { color: white; background-color: red; border: none; padding: 5px 10px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>現在の予約一覧</h1>
  <table id="reservation-table">
    <thead>
      <tr>
        <th>日付</th>
        <th>時間帯</th>
        <th>企業名</th>
        <th>匿名</th>
        <th>カテゴリ</th>
        <th>備考</th>
        <th>操作</th>
      </tr>
    </thead>
    <tbody>
      <!-- 予約情報がここに表示される -->
    </tbody>
  </table>
  <div class="back">
    <button onclick="goBack()">管理画面に戻る</button>
  </div>

  <script>
    function getDatabase() {
      const data = localStorage.getItem("calendarData");
      return data ? JSON.parse(data) : { blockedDates: [], reservations: [] };
    }

    function saveDatabase(db) {
      localStorage.setItem("calendarData", JSON.stringify(db));
    }

    function renderReservations() {
      const db = getDatabase();
      const tbody = document.querySelector("#reservation-table tbody");
      tbody.innerHTML = "";

      if (db.reservations.length === 0) {
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 7;
        td.textContent = "予約はまだありません";
        tr.appendChild(td);
        tbody.appendChild(tr);
        return;
      }

      db.reservations.forEach((res, index) => {
        const tr = document.createElement("tr");

        [res.date, res.time, res.company, res.anonymous, res.category, res.note].forEach(value => {
          const td = document.createElement("td");
          td.textContent = value;
          tr.appendChild(td);
        });

        // 削除ボタン
        const deleteBtn = document.createElement("button");
        deleteBtn.textContent = "削除";
        deleteBtn.className = "delete";
        deleteBtn.onclick = () => {
          if (confirm("この予約を削除しますか？")) {
            db.reservations.splice(index, 1);
            saveDatabase(db);
            renderReservations();
          }
        };

        const opTd = document.createElement("td");
        opTd.appendChild(deleteBtn);
        tr.appendChild(opTd);

        tbody.appendChild(tr);
      });
    }

    function goBack() {
      window.location.href = "admin_dashboard.html";
    }

    renderReservations();
  </script>
</body>
</html>
